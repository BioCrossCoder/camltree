# 用户手册

## 快速开始

***当用户想要快速上手使用本产品时，请遵循以下操作流程；程序将自动加载默认运行配置（用户未定制）或当前配置（用户已定制）。***

### 操作流程

`开始`→`定制工作流`→`选择输入文件`→`指定输出路径`→`提交`

1. 开始：点击`Start`按钮。

2. 定制工作流

    ***用户可以通过表格中的按钮选项定制工作流。***

    + *步骤1*：选择**分析策略**（`串联处理`/`并联处理`/`单独处理`）。
    + *步骤2*：选择**序列对齐**方法（`MAFFT`/`MACSE`/`跳过`）。
    + *步骤3*：选择**对齐优化**方法（`trimAl`/`跳过`）。
    + *步骤4*：选择**建树**方法（`IQ-TREE`/`MrBayes`/`跳过`）。
    + ***注意***：当**分析策略**为`并联处理`时不允许使用`MrBayes`；当**分析策略**为`并联处理`且`跳过`**建树**时不允许进行**序列对齐**或**对齐优化**。

3. 选择输入文件

    ***根据工作流的起点不同，对输入文件的格式和内容有不同的要求。***

    **格式要求**

    + `MAFFT`/`MACSE`

      >输入文件为**FASTA**格式序列文件。

    + `trimAl`/`IQ-TREE`/`MrBayes`

      >输入文件为**FASTA**/**ALN**/**MEGA**/**PHYLIP**/**NEXUS**格式序列对齐文件。

    + `Concatenation`

      >输入文件为一组**FASTA**/**ALN**/**MEGA**/**PHYLIP**/**NEXUS**格式序列对齐文件，不同文件中被拼接的序列必须名称相同。

    + `wASTRAL`

      >输入文件为多个**NEWICK**格式进化树文件，不同进化树中被合并的分支必须名称相同。

    **操作流程**

    + ***方法1***：选择文件
      + *步骤1*：点击`OPEN`按钮打开弹窗。
      + *步骤2*：选择输入文件（允许进行多选）；默认匹配是**FASTA**格式序列文件，当用户想匹配其它格式时，请通过弹窗中文件名输入框右侧的下拉列表选取相应类型；当输入文件无法被正确匹配显示时，请检查文件后缀并将其修改至合法或选取`All Files`进行匹配（不推荐）。
      + *步骤3*：点击`确定`按钮。
      + ***注意***：这种方式会覆盖已有的**输入文件**配置。

    + ***方法2***：键盘输入
      + *步骤1*：点击`MODIFY`按钮来激活文本区域。
      + *步骤2*：键盘输入文件路径（每行一个输入文件的路径）。
      + *步骤3*：点击`OK`按钮保存修改。
      + ***备注***：用户可以复制粘贴或通过系统快捷键撤销操作。

4. 指定输出路径

    ***工作流的输出会保存到用户指定的输出路径。***

    + ***方法1***：选择路径
      + *步骤1*：点击`SAVE`按钮打开弹窗。
      + *步骤2*：选择一个目录。
      + *步骤3*：输入自定义的目录名称（不能与现有文件或目录重名）。
      + *步骤4*：点击`确定`按钮。
      + ***注意***：这种方式会覆盖已有的**输出路径**配置。

    + ***方法2***：键盘输入
      + *步骤1*：点击`MODIFY`按钮来激活文本区域。
      + *步骤2*：键盘输入目标路径（只能输入一个路径且不允许换行）。
      + *步骤3*：点击`OK`按钮保存修改。
      + ***备注***：用户可以复制粘贴或通过系统快捷键撤销操作。

5. 提交

    ***完成上述步骤后，用户需要提交分析任务。***

    + 开始
      + *步骤1*：点击`RUN`按钮提交任务，会弹窗显示任务运行参数配置。
      + *步骤2*：点击`确定`按钮确认提交，任务将在后台运行。任务进度会显示在程序副窗口，点击任务进度项标题可以打开其输出目录。
      + ***参数检验***：如果**输出路径**或**输入文件**不合法，程序会阻止任务提交并弹窗报错。

    + 结束
      + 当任务结束时，程序会弹窗提示，可以点击`Go to the directory`按钮查看输出目录。
      + 工作流中存在`IQ-TREE`/`MrBayes`/`wASTRAL`的情况下，任务完成时可以点击`View in FigTree`按钮调用**FigTree**可视化查看输出结果。
      + ***异常***：任务执行过程中出错时，程序会直接中止任务并弹窗提示，可以点击`Show the logs`按钮查看错误日志。

6. 工具箱

    ***程序提供了3个JAVA工具的调用接口，可以通过`FigTree`/`ALTER`/`MACSE`按钮打开使用。***

    + [FigTree](http://tree.bio.ed.ac.uk/software/figtree)是一个常用于可视化查看进化树的工具，它也能用于编辑美化进化树并制作出版级图片。
    + [ALTER](https://github.com/sing-group/ALTER)是一个对齐序列格式转换工具，它可以针对不同程序的输入生成非标准的特定格式。
    + [MACSE](https://bioweb.supagro.inra.fr/macse/)是一个用于对齐编码基因的多序列对齐工具，并且还提供了一些其它的功能。

## 如何定制

***当用户需要个性化定制运行配置时，请遵循以下操作步骤；定制页面总是会显示当前配置。***

1. 跳转页面：点击`Customize`按钮。

2. 修改参数

    ***用户可以自定义任务中被调用工具的运行参数。***

    + ***方法1***：键盘输入
      + *步骤1*：点击`MODIFY`按钮来激活文本区域。
      + *步骤2*：键盘输入参数（不允许换行）。
      + *步骤3*：点击`OK`按钮保存修改。
      + ***备注***：用户可以复制粘贴或通过系统快捷键撤销操作。

    + ***方法2***：配置导入
      + *步骤1*：在下拉列表中选择配置（*前缀表示程序内置配置）。
      + *步骤2*：点击`LOAD`按钮。
      + *步骤2.5*：配置选择`...`时，通过弹窗选取**JSON**文件导入配置。
      + *步骤3*：检查弹窗内容无误后点击`确定`。
      + ***注意***：导入的运行参数会覆盖当前参数。

3. 开始任务：点击`NEXT`按钮跳转页面，后续操作接[快速开始](#快速开始)第2步。

4. 导出配置
    + *步骤1*：点击`SAVE`按钮，会弹窗显示导出配置内容。
    + *步骤2*：点击`确定`按钮打开保存文件窗口。
    + *步骤3*：选择一个输出目录。
    + *步骤4*：输入自定义的文件名称（不能与现有文件或目录重名）。
    + *步骤5*：点击`确定`按钮。
    + ***备注***：保存在默认目录**config**则配置会加载到下拉列表中，可以用于快捷导入。

## 注意事项

1. JAVA运行环境（JRE）是运行`FigTree`/`ALTER`/`MACSE`必要的依赖，用户需要自行本地安装并配置环境变量。

2. 工作流存在`Concatenation`/`wASTRAL`时，输入文件中的序列/树分支命名必须遵循它们的要求。

3. 在没有特定需求的情况下，推荐采用默认配置运行任务。
