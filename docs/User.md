# 用户手册

## 快速开始

***当用户想要快速上手使用本产品时，请遵循以下操作流程；程序将自动加载默认运行配置（用户未定制）或当前配置（用户已定制）。***

### 操作流程

`开始`→`定制工作流`→`选择输入文件`→`配置输出路径`→`提交任务运行`

1. 开始：点击`Start`按钮。

2. 定制工作流

    ***用户可以通过表格中的按钮选项定制工作流***

    + *步骤1*：选择分析策略（`串联处理`/`并联处理`/`单独处理`）。
    + *步骤2*：选择序列对齐方法（`MAFFT`/`MACSE`/`无`）。
    + *步骤3*：选择序列优化方法（`trimAl`/`无`）。
    + *步骤4*：选择建树方法（`IQ-TREE`/`MrBayes`/`无`）。
    + ***注意***：当采用并联处理时不允许使用`MrBayes`建树；采用并联处理且不建树时不允许进行序列对齐或对齐优化。

3. 选择输入文件

    ***根据工作流的起点不同，对输入文件的格式和内容有不同的要求***

    **不同工作流起点的输入文件要求**

    + `MAFFT`/`MACSE`

      >输入文件为**FASTA**格式序列文件。

    + `trimAl`/`IQ-TREE`/`MrBayes`

      >输入文件为**FASTA**/**ALN**/**MEGA**/**PHYLIP**/**NEXUS**格式序列对齐文件。

    + `Concatenation`

      >输入文件为一组**FASTA**/**ALN**/**MEGA**/**PHYLIP**/**NEXUS**格式序列对齐文件，不同文件中被拼接的序列必须名称相同。

    + `wASTRAL`

      >输入文件为多个**NEWICK**格式进化树文件，不同进化树中被合并的分支必须名称相同。

    **输入文件方法**

    + ***方法1***：选择文件
      + *步骤1*：点击`OPEN`按钮打开弹窗。
      + *步骤2*：选择输入文件（允许进行多选）；注意当运行任务为`figtree`时需要通过弹窗中文件名输入框右侧的下拉列表选择**Phylogeny Tree**类型文件。
      + *步骤3*：点击`确定`按钮。
      + ***注意***：这种方式会覆盖已有的输入文件配置。

    + ***方法2***：键盘输入路径
      + *步骤1*：点击`MODIFY`按钮开启文本框输入模式。
      + *步骤2*：键盘输入文件路径（每行一个输入文件的路径）。
      + *步骤3*：点击`OK`按钮保存修改。
      + ***备注***：用户可以复制粘贴或通过系统快捷键撤销文本输入操作。

4. 配置输出路径

    ***程序执行任务的结果会保存到用户指定的输出路径，需要注意的是`figtree`任务没有输出因此这项配置无效。***

    + ***方法1***：选择目录
      + *步骤1*：点击`SAVE`按钮打开弹窗。
      + *步骤2*：选择输出文件夹目录。
      + *步骤3*：输入自定义的目录名称。
      + *步骤4*：点击`确定`按钮。
      + ***注意***：这种方式会覆盖已有的输出路径配置。

    + ***方法2***：键盘输入路径
      + *步骤1*：点击`MODIFY`按钮开启文本框输入模式。
      + *步骤2*：键盘输入目标路径（只能输入一个路径且不允许手动换行）。
      + *步骤3*：点击`OK`按钮保存修改。
      + ***备注***：用户可以复制粘贴或通过系统快捷键撤销文本输入操作。

5. 提交任务运行

    ***在完成运行参数的配置和输入输出的指定后，需要用户主动提交任务。***

    + 任务开始
      + *步骤1*：点击`RUN`按钮提交任务执行，会弹窗显示任务运行参数配置。
      + *步骤2*：点击`确定`按钮提交任务，任务将在后台运行。
      + ***参数检验***：提交任务时，如果输出路径或输入文件不合法，程序会阻止提交并弹窗报错。

    + 任务结束
      + 当任务运行结束时，程序会弹窗提示，可以点击`Go to the directory`按钮查看输出结果目录。
      + 工作流中存在`IQ-TREE`/`MrBayes`/`wASTRAL`的情况下，任务完成时可以点击`View in FigTree`按钮调用**FigTree**可视化查看输出结果。
      + ***异常结束***：任务执行过程中出错时，程序会直接中止任务并弹窗提示，可以点击`Show the logs`按钮查看错误日志。

## 如何定制

***当用户需要个性化定制运行配置时，请遵循以下操作步骤；定制页面总是会显示当前配置。***

1. 跳转页面：点击`Customize`按钮。

2. 修改参数

    ***程序执行任务调用的工具可以自定义其运行参数。***

    **修改参数方法**

    + ***方法1***：从键盘输入
      + *步骤1*：点击`MODIFY`按钮开启文本框输入模式。
      + *步骤2*：键盘输入参数（不允许换行）。
      + *步骤3*：点击`OK`按钮保存修改。
      + ***备注***：用户可以复制粘贴或通过系统快捷键撤销文本输入操作。

    + ***方法2***：从配置导入
      + *步骤1*：在`config`下拉列表选择器选择配置（*开头表示程序内置配置）。
      + *步骤2*：点击`LOAD`按钮。
      + *步骤2.5*：`config`选择`...`时，选择**JSON**文件导入配置。
      + *步骤3*：检查弹窗内容无误后点击`确认`。
      + ***注意***：导入的运行参数会直接覆盖当前参数。

3. 开始任务：点击`NEXT`按钮跳转页面，后续操作接[快速开始](#快速开始)第2步。

4. 导出配置
    + *步骤1*：点击`SAVE`按钮，会弹窗显示导出配置内容。
    + *步骤2*：点击`确定`按钮打开保存文件窗口。
    + *步骤3*：选择输出文件夹目录。
    + *步骤4*：输入自定义的文件名称。
    + *步骤5*：点击`确定`按钮。
    + ***备注***：保存在弹窗默认的**config**目录则配置会加载到`config`选择器列表中，可以用于快捷导入。

## 注意事项

1. JAVA运行环境（JRE）是运行`FigTree`/`ALTER`/`MACSE`必要的依赖，需要在运行的电脑上本地安装JRE并将其可执行文件路径配置到环境变量中。

2. 工作流存在`Concatenation`/`wASTRAL`时，输入文件中的序列/树分支命名必须遵循它们的要求。

3. 在没有特定需求的情况下，推荐采用默认配置运行任务。
