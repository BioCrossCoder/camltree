# 用户手册

## 快速开始

***当用户想要快速上手使用本产品时，请遵循以下操作流程；程序将自动加载默认运行配置（用户未定制）或当前配置（用户已定制）。***

### 操作流程

`开始`→`选择输入文件`→`配置输出路径`→`选择运行任务`→`提交任务运行`

1. 开始：点击`Start`按钮。

2. 选择输入文件

    ***根据执行任务的类型不同，对输入文件的格式和内容有不同的要求。不同任务的区别见[这里](#任务流程)***

    **输入文件要求**

    + `camltree`
      + 输入文件为一组**FASTA**序列文件。
      + 每个FASTA文件存储一组需要被对齐的序列。
      + 多个FASTA文件存储一组相同来源的不同序列（不同文件中用一来源的序列会被拼接）。
      + FASTA文件内容格式要求见[注意事项](#注意事项)第2条。

    + `mafft`/`trimal`/`iqtree`
      + 输入文件为一个或多个**FASTA**序列文件。
      + 不同**FASTA**文件的内容不需要有任何关联。

    + `figtree`
      + 输入文件可以为空或任意数量**NWK**进化树文件。

    **输入文件方法**

    + ***方法1***：选择文件
      + *步骤1*：点击`OPEN`按钮打开弹窗。
      + *步骤2*：选择输入文件（允许进行多选）；注意当运行任务为`figtree`时需要通过弹窗中文件名输入框右侧的下拉列表选择**Phylogeny Tree**类型文件。
      + *步骤3*：点击`确定`按钮。
      + ***注意***：这种方式会覆盖已有的输入文件配置。

    + ***方法2***：键盘输入路径
      + *步骤1*：点击`MODIFY`按钮开启文本框输入模式。
      + *步骤2*：键盘输入文件路径（每行一个输入文件的路径）。
      + *步骤3*：点击`OK`按钮保存修改。
      + ***备注***：用户可以复制粘贴或通过系统快捷键撤销文本输入操作。

3. 配置输出路径

    ***程序执行任务的结果会保存到用户指定的输出路径，需要注意的是`figtree`任务没有输出因此这项配置无效。***

    + ***方法1***：选择目录
      + *步骤1*：点击`SAVE`按钮打开弹窗。
      + *步骤2*：选择输出文件夹目录。
      + *步骤3*：输入自定义的目录名称。
      + *步骤4*：点击`确定`按钮。
      + ***注意***：这种方式会覆盖已有的输出路径配置。

    + ***方法2***：键盘输入路径
      + *步骤1*：点击`MODIFY`按钮开启文本框输入模式。
      + *步骤2*：键盘输入目标路径（只能输入一个路径且不允许手动换行）。
      + *步骤3*：点击`OK`按钮保存修改。
      + ***备注***：用户可以复制粘贴或通过系统快捷键撤销文本输入操作。

4. 选择运行任务

    ***程序支持执行多种不同的任务，可以通过`tasks`下拉列表选择器来选择运行的任务***

    ### 任务流程

    + `camltree`
      + *步骤1*：调用**MAFFT**对输入的多个**FASTA**序列文件分别执行多序列对齐（多进程并行执行）。
      + *步骤2*：多序列对齐结果由**trimAl**进行序列裁剪（多进程并行执行）。
      + *步骤3*：经过裁剪的序列通过**NodeJS**脚本进行拼接。
      + *步骤4*：将拼接得到的**FASTA**序列文件输入**IQ-TREE**构建分子进化树。

    + `mafft`
      + 多进程并行调用**MAFFT**对输入的一个或多个**FASTA**序列文件分别执行多序列对齐。

    + `trimal`
      + 多进程并行调用**trimAl**对输入的一个或多个多序列对齐**FASTA**文件分别执行序列裁剪。

    + `iqtree`
      + 多进程并行调用**IQ-TREE**对输入的一个或多个多序列对齐**FASTA**文件分别构建分子进化树。

    + `figtree`
      + **输入为空时**：直接打开**FigTree**。
      + **输入不为空时**：调用**FigTree**打开一个或多个输入的**NWK**文件。

5. 提交任务运行

    ***在完成运行参数的配置和输入输出的指定后，需要用户主动提交任务。***

    + 任务开始
      + *步骤1*：点击`RUN`按钮提交任务执行，会弹窗显示任务运行参数配置。
      + *步骤2*：点击`确定`按钮提交任务，任务将在后台运行。
      + ***参数检验***：提交任务时，如果输出路径或输入文件不合法，程序会阻止提交并弹窗报错。

    + 任务结束
      + 当任务运行结束时，程序会弹窗提示，可以点击`Go to the directory`按钮查看输出结果目录。
      + `figtree`任务没有运行结束的弹窗提示。
      + `camltree`任务完成时可以点击`View in FigTree`按钮调用**FigTree**可视化查看输出结果。
      + ***异常结束***：任务执行过程中出错时，程序会直接中止任务并弹窗提示，可以点击`Show the logs`按钮查看错误日志。

## 如何定制

***当用户需要个性化定制运行配置时，请遵循以下操作步骤；定制页面总是会显示当前配置。***

1. 跳转页面：点击`Customize`按钮。

2. 修改参数

    ***程序执行任务调用的工具可以自定义其运行参数。***

    **修改参数方法**

    + ***方法1***：从键盘输入
      + *步骤1*：点击`MODIFY`按钮开启文本框输入模式。
      + *步骤2*：键盘输入参数（不允许换行）。
      + *步骤3*：点击`OK`按钮保存修改。
      + ***备注***：用户可以复制粘贴或通过系统快捷键撤销文本输入操作。

    + ***方法2***：从配置导入
      + *步骤1*：在`config`下拉列表选择器选择配置（*开头表示程序内置配置）。
      + *步骤2*：点击`LOAD`按钮。
      + *步骤2.5*：`config`选择`...`时，选择**JSON**文件导入配置。
      + *步骤3*：检查弹窗内容无误后点击`确认`。
      + ***注意***：导入的运行参数会直接覆盖当前参数。

3. 开始任务：点击`NEXT`按钮跳转页面，后续操作接[快速开始](#快速开始)第2步。

4. 导出配置
    + *步骤1*：点击`SAVE`按钮，会弹窗显示导出配置内容。
    + *步骤2*：点击`确定`按钮打开保存文件窗口。
    + *步骤3*：选择输出文件夹目录。
    + *步骤4*：输入自定义的文件名称。
    + *步骤5*：点击`确定`按钮。
    + ***备注***：保存在弹窗默认的**config**目录则配置会加载到`config`选择器列表中，可以用于快捷导入。

## 注意事项

1. JAVA运行环境（JRE）是运行FigTree必要的依赖；如果要在camltree任务结束后进行FigTree可视化或者运行figtree任务，则需要在运行的电脑上本地安装JRE并将其可执行文件路径配置到环境变量中。

2. 在integrated任务中需要被连接到一起的输入序列必须拥有完全相同的序列名称（在FASTA文件中序列信息行必须以>开头，其后的字符中位于分隔符前的所有字符组成的字符串会被识别为序列名称，分隔符是在字符串中检测到的第一个非字母数字的特殊符号（但不能为.或者>））以保证它们被正确地连接。

3. 在没有特定需求的情况下，推荐采用默认配置运行任务。
